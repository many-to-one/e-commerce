{% extends "admin/change_list.html" %}

{% block extrahead %}
    {{ block.super }}
    <style>
        /* Ukrywanie kolumny modified_hidden */
        #changelist-form th.column-modified_hidden,
        #changelist-form td.field-modified_hidden {
            display: none !important;
        }

        /* Spinner */
        #loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0%   { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
{% endblock %}

{% block branding %}
    {{ block.super }}
    <div id="loading-spinner">
        <div class="spinner"></div>
    </div>
{% endblock %}

{% block object-tools-items %}
    {{ block.super }}
    <li>
        <a href="{% url 'sync_allegro_offers' %}" class="btn btn-success float-right" style="margin-left: 5px;">
            ðŸ”„ Synchronizuj z ofertami Allegro
        </a>
    </li>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script>
      async function callDjangoAdminFunction(urlName) {
          const spinner = document.getElementById("loading-spinner");
          spinner.style.display = "block";

          try {
              const response = await fetch(urlName, {
                  method: "POST",
                  headers: {
                      "X-Requested-With": "XMLHttpRequest",
                      "X-CSRFToken": getCookie("csrftoken")
                  }
              });

              if (!response.ok) {
                  throw new Error("BÅ‚Ä…d: " + response.status);
              }

              const data = await response.json();
              alert("Operacja zakoÅ„czona sukcesem!");
          } catch (error) {
              alert("CoÅ› poszÅ‚o nie tak!");
          } finally {
              spinner.style.display = "none";
          }
      }

      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== "") {
              const cookies = document.cookie.split(";");
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  if (cookie.startsWith(name + "=")) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }
    </script>

{% endblock %}