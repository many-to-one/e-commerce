{% extends "admin/base_site.html" %}
{% block content %}

<h1>Status batcha {{ batch.id }}</h1>

<p>Status: <strong>{{ batch.status }}</strong></p>

<div style="width: 100%; background: #ddd; border-radius: 6px; margin: 20px 0;">
    <div id="progress-bar"
         style="width: 0%; background: #4caf50; height: 24px; border-radius: 6px; transition: width 0.5s;">
    </div>
</div>

<span id="batch-processed" style="display:none;">
    {{ batch.processed_orders|default:0 }}
</span>
<span id="batch-total" style="display:none;">
    {{ batch.total_orders|default:0 }}
</span>

<p><strong><span id="progress-text"></span></strong></p>

<script>
    const batchEl = document.getElementById("batch-data");

    const processed = parseInt(batchEl.dataset.processed, 10) || 0;
    const total = parseInt(batchEl.dataset.total, 10) || 0;
    const percent = total > 0 ? Math.round((processed / total) * 100) : 0;

    document.getElementById("progress-bar").style.width = percent + "%";
    document.getElementById("progress-text").innerText =
        processed + " / " + total + " (" + percent + "%)";
</script>

{% if batch.zip_file %}
    <p>ZIP gotowy — pobieranie...</p>
    <script>
        window.location.href = "{{ batch.zip_file.url }}";
    </script>
{% else %}
    <p>Przetwarzanie w toku... Odświeżanie co 2 sekundy.</p>
    <script>
        setTimeout(function() {
            window.location.reload();
        }, 2000);
    </script>
{% endif %}

{% endblock %}
